
## [LOJ T110664](https://www.luogu.com.cn/problem/T110664)：矩形面积并

这个题如果不是平行的矩形怎么做呢？如果是凸多边形的并和交怎么做呢？

此题显然可以把矩形看作两条边，一正一负，然后更新最小值，查询最小值非零的区间个数即可

然后我们不妨想象是左开右闭的。

## [LOJ P1823](https://www.luogu.com.cn/problem/P1823)：经典问题：问有多少对元素，它们之间没有比它们都大的元素

用单调栈存可以被当前位置的人看到的人的编号，显然是单调不增的（你回头一看，看到的人升高时单调不减的）。由于有身高相同的情况，所以需要合并相同身高。

## [洛谷 U122053 选择题](https://www.luogu.com.cn/problem/U122053?contestId=31675)：**经典问题**：每个人说另一个人是不是好人， 好人只说真话，坏人只说慌话，输出有多少种可能的情况，并输出可能的情况下，最多的好人和最少的好人数

`val[i]` 表示第 $i$ 个人是否为好人， `w[i,j]` 表示$i$ 说 $j$ 是好人还是坏人，或 $j$ 说 $i$ 是好人还是坏人，那么必然 `val[i] ^ val[j] = !w[i,j]`


## [洛谷 U122055 出生点](https://www.luogu.com.cn/problem/U122055?contestId=31675) ：简单包容排斥

**仅考虑 $x$-轴**

当$k=0$ 时，那么距离之和就是
$$
m^2 \sum_{i=1}^n i(n-i) = m^2 \sum_{1} ^n i(n-1) - i(i-1) = \frac{m^2(n-1)n(n+1)}{6}
$$
然后我们减去 $k$ 个障碍点和其它所有点之间的距离
$$
m  \sum _{i=1} ^k \sum_{t=1} ^n |a[i] - t| = m  \sum _{i=1} ^k \frac{(a[i])(a[i]-1) + (n-a[i])(n-a[i] + 1)}{2}
$$
再加上 $k$ 个障碍点之间的距离

不妨按照 $x$-轴排序，然后把前缀和 `sa[i]` 求一下，再依次计算



## [洛谷 U122054 强迫症](https://www.luogu.com.cn/problem/U122054?contestId=31675) : [圆上 $n$ 个点构成的无交错边的图的个数 $f_n$](http://oeis.org/A054726)

$f_0 = 1, f_1 = 1, f_2 = 2, f_3 = 8$，考虑 $n+1$ 个点，如果第 $n+1$ 点与其他点没有边相连有 $f_n$ 种，如果相连，设最小的数为 $i$, 那么一边有 $f_i$ 种（注意到 $n+1$ 这个节点可以不管，因为它不跟小于 $i$ 的节点相连），另一边有 $\frac{f_{n+2-i}}{2}$，即
$$
f_{n + 1} = f_n + \frac{1}{2}\sum_{i = 1} ^ n f_i f_{n+2-i}
$$
化简一下，可知 
$$
f_{n+1} = 2f_n + \sum_{i=2} ^n f_i f_{n+2-i}
$$
我们令 $g_n = f_{n+1}$，则 $g_n = 2g_{n-1} + \sum_{i=2} ^ n g_{i-1} g_{n+1-i} = 2 g_{n-1} + \sum_{i=1} ^{n-1} g_i g_{n-i}$，所以 $g_n = \frac{2}{3} g_{n-1} + \frac{1}{3} \sum_{i=0} ^n g_i g_{n-i}$。考虑 $g_n$ 的生成函数 $g(z)$：
$$
g(z) = \sum_{i = 0} ^ {\infty} g_n z^n = g_0 + \frac{2}{3}  \sum_{i = 1} ^ {\infty} g_{n-1} z^n + \frac{1}{3} \sum_{i = 1} ^ {\infty} \sum_{i=0} ^ n g_i g_{n-i} z^n = g_0 + \frac{2}{3} z g(z) + \frac{1}{3} (g^2(z)  - g_0 ^ 2)
$$
因此 $\frac{1}{3} g^2(z) + (\frac{2}{3} z - 1) g(z) + \frac{2}{3} = 0$，从而 $g(z) = \frac{3-2z \pm \sqrt{1 - 12 z + 4z^2}}{2}$, 由 $g_1 = 2$ 知 $g(z) = \frac{3-2z - \sqrt{1 - 12 z + 4z^2}}{2}$，从而 $f(z) = f_0 + z g(z) = 1 + \frac{3}{2} z - z^2 - \frac{z}{2} \sqrt{1 - 12 z + 4 z^2}$。
$$
g'(z) = -1 - \frac{2z - 3}{\sqrt{1 - 12 z + 4 z^2}} = \frac{3-2z - \sqrt{1 - 12 z + 4 z^2}}{\sqrt{1 - 12 z + 4 z^2}}
$$

$$
(1 - 12z + 4 z^2) g'(z) = (3-2z - \sqrt{1 - 12 z + 4 z^2}) (\sqrt{1 - 12 z + 4 z^2}) = (3 - 2z) (3-2z - 2g(z)) - (1 - 12z + 4 z^2 = (4z - 6) g(z) + 8
$$

因此 $(n + 1)g_{n+1} - 12 n g_n + 4(n-1)g_{n-1} = 4 g_{n-1} - 6 g_n$，整理得到 $(n+1)g_{n+1}  = (12 n - 6) g_n - (4n-8)g_{n-1}$

从而 $(n+1)f_{n+2} = (12 n - 6) f_{n+1} - (4n - 8) f_n$，即递推公式 $f_{n} = \frac{ (12 n - 30) f_{n-1} - (4 n - 16) f_{n-2} }{n-1}$。

所以原问题的答案就是 
$$
\frac{ \sum_{i = 0} ^{n - 2} \sum_{j = i + 1} ^ {n-1} a_i a_j \frac{f_{j-i+1}}{2} \frac{f_{n+i-j+1}}{2} }{f_n} = \frac{ \sum_{i = 0} ^{n - 2} \sum_{j = i + 1} ^ {n-1} a_i a_j f_{j-i+1} f_{n+i-j+1}}{ 4 f_n}
$$
仅看分子：
$$
\sum_{i = 0} ^{n - 2} \sum_{j = i + 1} ^ {n-1} a_i a_j f_{j-i+1} f_{n+i-j+1} = \sum_{t = 2} ^ n f_t f_{n-t+2} \sum_{i=0}^{n-t} a_i a_{i+t-1}
$$
如果我们定义 $b_i = a_{n-1-i}$，$c_t = \sum_{i = 0} ^{t} a_{t-i} b_{i} = \sum_{i = 0} ^{t} a_{i} b_{t-i} = \sum_{i = 0} ^{t} a_{i} a_{n-1-(t-i)}$，则 $c_{n-t} = \sum_{i = 0} ^{n-t} a_{i} a_{n-1-(n-t-i)} = \sum_{i = 0} ^{n-t} a_{i} a_{i+t-1}$ 。即答案为
$$
\frac{ \sum_{t = 2} ^ n f_t f_{n-t+2} \cdot c_{n-t} }{4 f_n}
$$